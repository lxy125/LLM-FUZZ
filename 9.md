# (2023-05) UTopia: Automatic Generation of Fuzz Driver using Unit Tests

<table><tbody><tr><td style="background-color: rgb(219, 238, 221);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">Author:</span></span></strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)"> Bokdeuk Jeong; Joonun Jang; Hayoon Yi; Jiin Moon; Junsik Kim; Intae Jeon; Taesoo Kim; WooChul Shim; Yong Ho Hwang;</span></span></p></td></tr><tr><td style="background-color: rgb(243, 250, 244);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)">Journal: (Publication Date: 2023-05)</span></span></strong></p></td></tr><tr><td style="background-color: rgb(219, 238, 221);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">Journal Tags:</span></span></strong></p></td></tr><tr><td style="background-color: rgb(243, 250, 244);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)">Local Link: </span></span></strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)"><a href="zotero://open-pdf/0_RVV5VFA7" rel="noopener noreferrer nofollow">Jeong ç­‰ - 2023 - UTopia Automatic Generation of Fuzz Driver using Unit Tests.pdf</a></span></span></p></td></tr><tr><td style="background-color: rgb(219, 238, 221);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">DOI: </span></span></strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)"><a href="https://doi.org/10.1109/SP46215.2023.10179394" rel="noopener noreferrer nofollow">10.1109/SP46215.2023.10179394</a></span></span></p></td></tr><tr><td style="background-color: rgb(243, 250, 244);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)">Abstract: </span></span></strong><em><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)">Fuzzing is arguably the most practical approach for detecting security bugs in software, but a non-trivial extent of efforts is required for its adoption. To be effective, high-quality fuzz drivers should be first formulated with a proper sequence of APIs that can exhaustively explore the program states. To alleviate this burden, existing solutions attempt to generate fuzz drivers either by inferring the valid sequences of APIs from the consumer code (i.e., actual uses of APIs) or by directly extracting them from sample executions. Unfortunately, all existing approaches suffer from a common problem: the observed API sequences, either statically inferred or dynamically monitored, are intermingled with custom application logics. However, we observed that the unit tests are carefully crafted by the actual designer of the APIs to validate their proper usages, and importantly, it is a common practice to write the unit tests during their development (e.g., over 70% of popular GitHub projects).In this paper, we propose, UTopia, an open-source tool and analysis algorithm that can automatically synthesize effective fuzz drivers from existing unit tests with near-zero human involvement. To demonstrate its effectiveness, we applied UTopia to 55 open-source project libraries, including Tizen and Node.js, and automatically generated 5K fuzz drivers from 8K eligible unit tests. In addition, we executed the generated fuzzers for approximately 5 million per-core hours and discovered 123 bugs. More importantly, 2.4K of the generated fuzz drivers were adopted to the continuous integration process of the Tizen project, indicating the quality of the synthesized fuzz driver. The proposed tool and results are publicly available and maintained for a broader adoption among both researchers and practitioners.</span></span></em></p></td></tr><tr><td style="background-color: rgb(219, 238, 221);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">Note Date: </span></span></strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">2024/8/16 10:29:07</span></span></p></td></tr></tbody></table>

## ğŸ“œ Research Core

* * *

> Tips: What was done, what problem was solved, innovations and shortcomings?

### âš™ï¸ Content

è¯¥æ–‡æå‡ºäº†UTopiaï¼Œä¸€ç§åˆ©ç”¨ç°æœ‰å•å…ƒæµ‹è¯•ï¼ˆUnit Tests, UTsï¼‰è‡ªåŠ¨ç”Ÿæˆæ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºï¼ˆfuzz driversï¼‰çš„å¼€æºå·¥å…·å’Œåˆ†æç®—æ³•ã€‚UTopiaé€šè¿‡åˆ†æå•å…ƒæµ‹è¯•ï¼Œè‡ªåŠ¨åˆæˆé«˜æ•ˆçš„æ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºï¼Œå¹¶ä¸”èƒ½å¤Ÿå‡å°‘äººä¸ºå¹²é¢„ï¼Œæ˜¾è‘—æé«˜æµ‹è¯•æ•ˆç‡ã€‚

### ğŸ’¡ Innovations

**åˆ©ç”¨å•å…ƒæµ‹è¯•ç”Ÿæˆæ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åº**ï¼šUTopiaé€šè¿‡åˆ†æç°æœ‰çš„å•å…ƒæµ‹è¯•ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæˆæ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºï¼Œé¿å…äº†ä¼ ç»Ÿæ–¹æ³•ä¸­æ¨æ–­APIè°ƒç”¨é¡ºåºçš„å¤æ‚æ€§ã€‚

**è‡ªåŠ¨åŒ–å‚æ•°å¤„ç†**ï¼šUTopiaé€šè¿‡é™æ€åˆ†æè‡ªåŠ¨è¯†åˆ«APIè°ƒç”¨ä¸­çš„å‚æ•°å…³ç³»ï¼Œç¡®ä¿ç”Ÿæˆçš„æ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºä¸ä¼šå› ä¸ºæ— æ•ˆçš„å‚æ•°è€Œå¯¼è‡´å‡é˜³æ€§å´©æºƒã€‚

â€œUnlike a prior research that focuses on correctly reconstructing valid API sequences from any given consumer, we take advantage of explicit API sequences written in unit tests to completely sidestep the aforementioned challenges of API sequence synthesis.â€ ([Jeong ç­‰, 2023, p. 3](zotero://select/library/items/VGSBPKQG)) ([pdf](zotero://open-pdf/library/items/RVV5VFA7?page=3))

â€œTo maintain valid argument semantics, UTOPIA preserves the original data flow in UT and finds where to inject fuzz input (i.e., fuzz target) and how they should be mutated (API attribute) through static analysis.â€ ([Jeong ç­‰, 2023, p. 4](zotero://select/library/items/VGSBPKQG)) ([pdf](zotero://open-pdf/library/items/RVV5VFA7?page=4))

### ğŸ§© Shortcomings

**å¤æ‚çš„æ¡†æ¶åˆ†æ**ï¼šä½¿ç”¨å•å…ƒæµ‹è¯•ç”Ÿæˆæ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºè™½ç„¶å‡å°‘äº†APIè°ƒç”¨é¡ºåºæ¨æ–­çš„å¤æ‚æ€§ï¼Œä½†å¼•å…¥äº†å•å…ƒæµ‹è¯•æ¡†æ¶æœ¬èº«çš„å¤æ‚æ€§ï¼Œç‰¹åˆ«æ˜¯åœ¨å¤„ç†é—´æ¥è°ƒç”¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´åˆ†æç²¾åº¦ä¸‹é™ã€‚

â€œHowever, simply feeding the UTs as consumers to existing approaches would not appropriately work because the use of UTs introduces its own set of challenges (UT-C).â€ ([Jeong ç­‰, 2023, p. 4](zotero://select/library/items/VGSBPKQG)) ([pdf](zotero://open-pdf/library/items/RVV5VFA7?page=4))

## ğŸ” Research Content

* * *

### ğŸ’§ Data

UTopiaä½¿ç”¨æ¥è‡ªGitHubã€Androidå’ŒOSS-Fuzzé¡¹ç›®çš„55ä¸ªå¼€æºé¡¹ç›®çš„å•å…ƒæµ‹è¯•æ•°æ®ï¼Œè¿™äº›é¡¹ç›®æ¶µç›–äº†C/C++åº“ï¼Œä½¿ç”¨gtestã€boostæˆ–TCTä½œä¸ºå•å…ƒæµ‹è¯•æ¡†æ¶ã€‚

â€œTo demonstrate the effectiveness of automatic fuzz driver synthesis, we applied UTOPIA to 55 open-source project libraries (25 projects from Table I and 30 from Tizen) among projects that satisfy the following conditions: 1) written in C/C++, 2) uses gtest [7], boost [6], or TCT [5] for UT, and 3) supports LLVM build on Linux.â€ ([Jeong ç­‰, 2023, p. 2](zotero://select/library/items/VGSBPKQG)) ([pdf](zotero://open-pdf/library/items/RVV5VFA7?page=2))

### ğŸ‘©ğŸ»â€ğŸ’» Method

UTopiaçš„æ ¸å¿ƒæµç¨‹åŒ…æ‹¬å››ä¸ªæ­¥éª¤ï¼šUTæ¡†æ¶ç»“æ„åˆ†æã€APIå±æ€§åˆ†æã€æ¨¡ç³Šç›®æ ‡é€‰æ‹©å’Œæ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºåˆæˆã€‚é€šè¿‡è¿™äº›æ­¥éª¤ï¼ŒUTopiaèƒ½å¤Ÿè‡ªåŠ¨åˆ†æå•å…ƒæµ‹è¯•ä»£ç ï¼Œè¯†åˆ«æ½œåœ¨çš„æ¨¡ç³Šç›®æ ‡å¹¶ç”Ÿæˆç›¸åº”çš„æ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºã€‚

â€œUTOPIA analyzes both UT and target library code to transform UT into effective fuzz drivers. The overall workflow of UTOPIA is illustrated in Figure 2.â€ ([Jeong ç­‰, 2023, p. 5](zotero://select/library/items/VGSBPKQG)) ([pdf](zotero://open-pdf/library/items/RVV5VFA7?page=5))

### ğŸ”¬ Experiment

UTopiaåœ¨55ä¸ªå¼€æºé¡¹ç›®ä¸­è‡ªåŠ¨ç”Ÿæˆäº†2715ä¸ªæ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºï¼Œå¹¶åœ¨500ä¸‡ä¸ªæ ¸å°æ—¶çš„æ¨¡ç³Šæµ‹è¯•æ‰§è¡Œä¸­å‘ç°äº†123ä¸ªæ–°æ¼æ´ã€‚è¿™äº›ç»“æœè¡¨æ˜ï¼ŒUTopiaç”Ÿæˆçš„æ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºåœ¨ä»£ç è¦†ç›–ç‡å’Œæ¼æ´æ£€æµ‹èƒ½åŠ›æ–¹é¢æ˜¾è‘—ä¼˜äºä¼ ç»Ÿæ‰‹åŠ¨ç¼–å†™çš„é©±åŠ¨ç¨‹åºã€‚

â€œWith the use of UTOPIA, we could find and report a total of 123 bugs in popular open-source projects such as Tizen and libaom.â€ ([Jeong ç­‰, 2023, p. 2](zotero://select/library/items/VGSBPKQG)) ([pdf](zotero://open-pdf/library/items/RVV5VFA7?page=2))

### ğŸ“œ Conclusion

UTopiaé€šè¿‡è‡ªåŠ¨åŒ–ç”Ÿæˆæ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºï¼Œæå¤§åœ°å‡å°‘äº†å¼€å‘è€…çš„å·¥ä½œé‡ï¼Œå¹¶æ˜¾è‘—æé«˜äº†æ¨¡ç³Šæµ‹è¯•çš„è¦†ç›–ç‡å’Œæœ‰æ•ˆæ€§ã€‚è¿™ç§æ–¹æ³•ä¸ä»…èƒ½å¤Ÿæ£€æµ‹åˆ°å¼€å‘è€…åœ¨ä¼ ç»Ÿå•å…ƒæµ‹è¯•ä¸­é—æ¼çš„é”™è¯¯ï¼Œè¿˜èƒ½å¢å¼ºç°æœ‰æµ‹è¯•æ¡†æ¶çš„èƒ½åŠ›ã€‚

## ğŸ¤” Personal Summary

* * *

> Tips: What aspects did you question, how do you think it can be improved?
> 
> ### **UTæ¡†æ¶ç»“æ„åˆ†æ**
> 
> UTopiaé¦–å…ˆé€šè¿‡é™æ€åˆ†ææ¥ç†è§£ç°æœ‰å•å…ƒæµ‹è¯•ï¼ˆUnit Tests, UTsï¼‰çš„ç»“æ„ã€‚è¿™åŒ…æ‹¬è¯†åˆ«æµ‹è¯•æ¡†æ¶çš„ç±»å‹ï¼ˆå¦‚gtestã€boostæˆ–TCTï¼‰ï¼Œä»¥åŠäº†è§£å•å…ƒæµ‹è¯•å¦‚ä½•è°ƒç”¨åº“çš„APIã€‚åœ¨è¿™ä¸€é˜¶æ®µï¼ŒUTopiaä¼šè§£ææµ‹è¯•ä»£ç ï¼Œæå–å‡ºæ¯ä¸ªå•å…ƒæµ‹è¯•ä¸­æ˜ç¡®çš„APIè°ƒç”¨åºåˆ—ã€‚
> 
> ### **APIå±æ€§åˆ†æ**
> 
> åœ¨ç†è§£äº†å•å…ƒæµ‹è¯•çš„ç»“æ„ä¹‹åï¼ŒUTopiaè¿›è¡ŒAPIå±æ€§åˆ†æã€‚è¿™ä¸€æ­¥éª¤çš„ç›®çš„æ˜¯è¯†åˆ«APIè°ƒç”¨ä¸­çš„å‚æ•°åŠå…¶ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªAPIè°ƒç”¨çš„æŸä¸ªå‚æ•°ä¾èµ–äºå¦ä¸€ä¸ªAPIçš„è¿”å›å€¼ï¼ŒUTopiaéœ€è¦ç¡®ä¿è¿™ç§ä¾èµ–å…³ç³»åœ¨æ¨¡ç³Šæµ‹è¯•ä¸­ä¹Ÿèƒ½å¾—åˆ°ç»´æŠ¤ã€‚
> 
> ### **æ¨¡ç³Šç›®æ ‡é€‰æ‹©**
> 
> UTopiaé€šè¿‡åˆ†æç°æœ‰å•å…ƒæµ‹è¯•ä»£ç ï¼Œç¡®å®šå“ªäº›éƒ¨åˆ†æ˜¯æ½œåœ¨çš„æ¨¡ç³Šæµ‹è¯•ç›®æ ‡ã€‚è¿™äº›ç›®æ ‡é€šå¸¸æ˜¯é‚£äº›åœ¨å•å…ƒæµ‹è¯•ä¸­å·²ç»æ¶‰åŠåˆ°ä½†å¯èƒ½æœªç»è¿‡å……åˆ†æµ‹è¯•çš„APIã€‚UTopiaä¼šé€‰æ‹©è¿™äº›ç›®æ ‡ï¼Œå¹¶å†³å®šå¦‚ä½•å°†æ¨¡ç³Šè¾“å…¥æ³¨å…¥åˆ°è¿™äº›ç›®æ ‡çš„å‚æ•°ä¸­ã€‚
> 
> ### **æ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºåˆæˆ**
> 
> åœ¨å®Œæˆä¸Šè¿°åˆ†æåï¼ŒUTopiaå°†ç”Ÿæˆçš„æ¨¡ç³Šæµ‹è¯•ç›®æ ‡å’ŒAPIè°ƒç”¨åºåˆ—ç»“åˆèµ·æ¥ï¼Œåˆæˆæœ€ç»ˆçš„æ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºã€‚è¿™ä¸ªé©±åŠ¨ç¨‹åºä¼šæ›¿æ¢åŸæœ‰å•å…ƒæµ‹è¯•ä¸­çš„å›ºå®šè¾“å…¥ï¼Œè½¬è€Œä½¿ç”¨æ¨¡ç³Šå™¨ç”Ÿæˆçš„éšæœºè¾“å…¥ã€‚

### è¯¥æ–‡æå‡ºäº†UTopiaï¼Œä¸€ç§åˆ©ç”¨ç°æœ‰å•å…ƒæµ‹è¯•ï¼ˆUnit Tests, UTsï¼‰è‡ªåŠ¨ç”Ÿæˆæ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºï¼ˆfuzz driversï¼‰çš„å¼€æºå·¥å…·å’Œåˆ†æç®—æ³•ã€‚UTopiaé€šè¿‡åˆ†æå•å…ƒæµ‹è¯•ï¼Œè‡ªåŠ¨åˆæˆé«˜æ•ˆçš„æ¨¡ç³Šæµ‹è¯•é©±åŠ¨ç¨‹åºï¼Œå¹¶ä¸”èƒ½å¤Ÿå‡å°‘äººä¸ºå¹²é¢„ï¼Œæ˜¾è‘—æé«˜æµ‹è¯•æ•ˆç‡ã€‚12. æ–‡çŒ®å¤„ç†åˆ†æï¼š`UTopia: Automatic Generation of Fuzz Driver using Unit Tests`

#### 9.1. åºå· + æ–‡ç« åç§°

åºå·: 12  
æ–‡ç« åç§°: *UTopia: Automatic Generation of Fuzz Driver using Unit Tests*

#### 9.2. æŸ¥çœ‹æ˜¯å¦åœ¨GitHubæˆ–å…¶ä»–ç½‘ç«™å­˜åœ¨ç›¸åº”ä»£ç 

ä»£ç å­˜åœ¨æ€§: æ–‡ä¸­æåˆ°UTopiaæ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œå¯ä»¥åœ¨GitHubä¸Šæ‰¾åˆ°ã€‚  
ä»£ç é“¾æ¥: [GitHub - UTopia](https://github.com/Samsung/UTopia)

#### 9.3. åŒºåˆ†å¯¹LLMè¿›è¡ŒFuzzè¿˜æ˜¯ç”¨LLMè¾…åŠ©Fuzz

è¯¥æ–‡çŒ®æœªæ¶‰åŠLLMçš„fuzzingæˆ–LLMè¾…åŠ©fuzzingã€‚

#### 9.4. æ¯ä¸ªfuzzçš„ç”Ÿæˆæµ‹è¯•æ ·ä¾‹æ˜¯ä»€ä¹ˆï¼Œå¯¹è±¡æ˜¯ä»€ä¹ˆï¼Œå’Œç”Ÿæˆç­–ç•¥

- ç”Ÿæˆçš„æµ‹è¯•æ ·ä¾‹: //**ç”±å•å…ƒæµ‹è¯•ï¼ˆUTï¼‰ç”Ÿæˆçš„fuzzé©±åŠ¨å™¨**ï¼Œä¸»è¦åŒ…å«APIè°ƒç”¨åºåˆ—ã€‚
- æµ‹è¯•å¯¹è±¡: 55ä¸ªå¼€æºé¡¹ç›®åº“ï¼ŒåŒ…æ‹¬Tizenå’ŒNode.jsåº“ã€‚
- ç”Ÿæˆç­–ç•¥:
  
    - **å•å…ƒæµ‹è¯•è½¬æ¢**: UTopiaé€šè¿‡åˆ†æç°æœ‰çš„å•å…ƒæµ‹è¯•ï¼Œè¯†åˆ«APIè°ƒç”¨åºåˆ—ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„fuzzé©±åŠ¨å™¨ã€‚
    - **æ ¹å®šä¹‰åˆ†æ**: é€šè¿‡é™æ€åˆ†æè¿½è¸ªAPIå‚æ•°çš„æºå¤´ï¼Œä»¥ç¡®ä¿æ¨¡ç³Šæµ‹è¯•è¾“å…¥çš„æœ‰æ•ˆæ€§å’Œè¯­ä¹‰ä¸€è‡´æ€§ã€‚
    - **APIå±æ€§åˆ†æ**: è¯†åˆ«APIå‚æ•°çš„å±æ€§ï¼Œå¦‚è¾“å‡ºã€æ–‡ä»¶è·¯å¾„ã€åˆ†é…å¤§å°ã€å¾ªç¯è®¡æ•°ã€æ•°ç»„é•¿åº¦ç­‰ï¼Œä»¥æŒ‡å¯¼fuzzè¾“å…¥çš„å˜å¼‚ç­–ç•¥ã€‚

#### 9.5. è‹¥æ˜¯Fuzz for LLMï¼Œè¯·æ³¨æ˜æµ‹è¯•çš„æ˜¯LLMå“ªä¸€éƒ¨åˆ†

è¯¥æ–‡çŒ®æœªæ¶‰åŠå¯¹LLMçš„fuzzingã€‚

#### 9.6. è‹¥æ˜¯LLM for Fuzzï¼Œè¯·æ³¨æ˜LLMåœ¨Fuzzä¸­å‘æŒ¥äº†ä»€ä¹ˆä½œç”¨

è¯¥æ–‡çŒ®æœªæ¶‰åŠLLMè¾…åŠ©fuzzingã€‚

### æ€»ç»“

æœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°çš„æ–¹æ³•UTopiaï¼Œé€šè¿‡è‡ªåŠ¨ç”Ÿæˆfuzzé©±åŠ¨å™¨æ¥æ”¹è¿›ç°æœ‰çš„å•å…ƒæµ‹è¯•ï¼Œå¹¶é€šè¿‡é™æ€åˆ†æç¡®ä¿ç”Ÿæˆçš„fuzzé©±åŠ¨å™¨èƒ½å¤Ÿæœ‰æ•ˆè¦†ç›–ä»£ç åº“ä¸­çš„æ½œåœ¨æ¼æ´ã€‚UTopiaå·²è¢«æˆåŠŸåº”ç”¨äº55ä¸ªå¼€æºé¡¹ç›®ï¼Œå¹¶æŠ¥å‘Šäº†123ä¸ªæ–°æ¼æ´ã€‚å·¥å…·ä»£ç å·²åœ¨GitHubä¸Šå¼€æºã€‚