# (2024-04-12) RPG: Rust Library Fuzzing with Pool-based Fuzz Target Generation and Generic Support

<table><tbody><tr><td style="background-color: rgb(219, 238, 221);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">Author:</span></span></strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)"> Zhiwu Xu; Bohao Wu; Cheng Wen; Bin Zhang; Shengchao Qin; Mengda He;</span></span></p></td></tr><tr><td style="background-color: rgb(243, 250, 244);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)">Journal: (Publication Date: 2024-04-12)</span></span></strong></p></td></tr><tr><td style="background-color: rgb(219, 238, 221);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">Journal Tags:</span></span></strong></p></td></tr><tr><td style="background-color: rgb(243, 250, 244);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)">Local Link: </span></span></strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)"><a href="zotero://open-pdf/0_3978GNSK" rel="noopener noreferrer nofollow">Xu ç­‰ - 2024 - RPG Rust Library Fuzzing with Pool-based Fuzz Target Generation and Generic Support.pdf</a></span></span></p></td></tr><tr><td style="background-color: rgb(219, 238, 221);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">DOI: </span></span></strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)"><a href="https://doi.org/10.1145/3597503.3639102" rel="noopener noreferrer nofollow">10.1145/3597503.3639102</a></span></span></p></td></tr><tr><td style="background-color: rgb(243, 250, 244);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)">Abstract: </span></span></strong><em><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(243, 250, 244)">Rust libraries are ubiquitous in Rust-based software development. Guaranteeing their correctness and reliability requires thorough analysis and testing. Fuzzing is a popular bug-finding solution, yet it requires writing fuzz targets for libraries. Recently, some automatic fuzz target generation methods have been proposed. However, two challenges remain: (1) how to generate diverse API sequences that prioritize unsafe code and interactions to reveal bugs in Rust libraries; (2) how to provide support for the generic APIs and verify both syntactic and semantic validity of the fuzz targets to enable more comprehensive testing of Rust libraries. In this paper, we propose RPG, an automatic fuzz target synthesis technique to support Rust library fuzzing. RPG uses a pool-based search to generate diverse and unsafe API sequences, and synthesizes fuzz targets with generic support and validity check. The experimental results demonstrate that RPG enhances both the quality of the generated fuzz targets and the bug-finding ability through poolbased generation and generic support, substantially outperforming the state-of-the-art. Moreover, RPG has discovered 25 previously unknown bugs from 50 well-known Rust libraries available on Crates.io.</span></span></em></p></td></tr><tr><td style="background-color: rgb(219, 238, 221);"><p><strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">Note Date: </span></span></strong><span style="color: rgb(25, 60, 71)"><span style="background-color: rgb(219, 238, 221)">2024/8/16 09:23:28</span></span></p></td></tr></tbody></table>

## ğŸ“œ Research Core

* * *

> Tips: What was done, what problem was solved, innovations and shortcomings?

### âš™ï¸ Content

æ–‡ç« æå‡ºäº†ä¸€ç§åä¸ºRPGçš„è‡ªåŠ¨æ¨¡ç³Šæµ‹è¯•ç›®æ ‡åˆæˆæŠ€æœ¯ï¼Œç”¨äºæµ‹è¯•Ruståº“ã€‚RPGé€šè¿‡åŸºäºæ± çš„æ–¹æ³•ç”ŸæˆAPIåºåˆ—ï¼Œä¼˜å…ˆå¤„ç†ä¸å®‰å…¨ä»£ç å’Œäº¤äº’ï¼Œä»è€Œå¢å¼ºäº†æ¼æ´å‘ç°èƒ½åŠ›ã€‚è§£å†³äº†Ruståº“çš„æœ‰æ•ˆæµ‹è¯•é—®é¢˜ï¼Œè¿™äº›åº“æ— æ³•ç‹¬ç«‹è¿è¡Œå¹¶ä¸”ç¼ºä¹å…¨é¢çš„æ¨¡ç³Šæµ‹è¯•ç›®æ ‡ï¼Œç‰¹åˆ«æ˜¯å¯¹äºä½¿ç”¨ä¸å®‰å…¨ä»£ç å’Œæ³›å‹APIçš„åº“ã€‚

### ğŸ’¡ Innovations

**åŸºäºæ± çš„æœç´¢æ–¹æ³•**ï¼šæå‡ºäº†ä¸€ç§æ–°çš„åŸºäºæ± çš„ç”Ÿæˆæ–¹æ³•ï¼Œç”¨äºç”Ÿæˆèƒ½å¤Ÿæ­ç¤ºRuståº“ä¸­æ¼æ´çš„å¤šæ ·åŒ–APIåºåˆ—ã€‚

**æ³›å‹æ”¯æŒå’Œæœ‰æ•ˆæ€§æ£€æŸ¥**ï¼šæä¾›äº†å¯¹æ³›å‹APIçš„æ”¯æŒä»¥åŠåºåˆ—çš„è¯­æ³•å’Œè¯­ä¹‰æœ‰æ•ˆæ€§æ£€æŸ¥ï¼Œä»¥ç”Ÿæˆæ›´å¤šæœ‰æ•ˆçš„æ¨¡ç³Šæµ‹è¯•ç›®æ ‡ã€‚â€œWe propose a novel pool-based method to generate diverse API sequences that expose bugs in Rust libraries.â€ ([Xu ç­‰, 2024, p. 1522](zotero://select/library/items/WZEKF2GP)) ([pdf](zotero://open-pdf/library/items/3978GNSK?page=2))

### ğŸ§© Shortcomings

## ğŸ” Research Content

* * *

### ğŸ’§ Data

ä½¿ç”¨ä»crates.ioä¸Š50ä¸ªæµè¡Œçš„Ruståº“è¿›è¡Œå½»åº•è¯„ä¼°ï¼Œæ¶µç›–äº†ä¸åŒè§„æ¨¡å’ŒåŠŸèƒ½çš„åº“ã€‚

â€œWe have implemented a prototype of RPG and performed a thorough evaluation on 50 popular Rust libraries from crates.ioâ€ ([Xu ç­‰, 2024, p. 1522](zotero://select/library/items/WZEKF2GP)) ([pdf](zotero://open-pdf/library/items/3978GNSK?page=2))

### ğŸ‘©ğŸ»â€ğŸ’» Method

RPGä¸»è¦é€šè¿‡é™æ€åˆ†ææå–Ruståº“ä¸­çš„ç±»å‹ä¿¡æ¯å’Œå…ƒæ•°æ®ï¼Œæ„å»ºAPIä¾èµ–å›¾ï¼Œç„¶åä½¿ç”¨åŸºäºæ± çš„ç”Ÿæˆæ–¹æ³•ç”ŸæˆAPIåºåˆ—ã€‚

â€œRPG primarily leverages static analysis to obtain rich type information and metadata available in Rust libraries and constructs an API dependency graphâ€ ([Xu ç­‰, 2024, p. 1522](zotero://select/library/items/WZEKF2GP)) ([pdf](zotero://open-pdf/library/items/3978GNSK?page=2))

### ğŸ”¬ Experiment

RPGåœ¨50ä¸ªæµè¡Œçš„Ruståº“ä¸Šè¿›è¡Œäº†å®éªŒï¼Œç»“æœæ˜¾ç¤ºï¼ŒRPGèƒ½å¤Ÿç”Ÿæˆæœ‰æ•ˆçš„æ¨¡ç³Šç›®æ ‡ï¼Œå®ç°äº†71.8%çš„APIè¦†ç›–ç‡å’Œ11.1%çš„ä¾èµ–è¦†ç›–ç‡ï¼Œå¹¶å‘ç°äº†25ä¸ªä»¥å‰æœªçŸ¥çš„æ¼æ´ã€‚

â€œWe have implemented a prototype of RPG and performed a thorough evaluation on 50 popular Rust libraries from crates.io. The obtained results demonstrate that RPG is able to generate valid fuzz targets, achieving an API coverage rate of 71.8% and a dependency coverage rate of 11.1%. By utilizing fuzz targets generated by RPG for further fuzzing, RPG is able to detect more bugs compared to the state-of-the-art approaches (i.e., RULF [24], Miri [35] and Rudra [4]). These bugs include 25 previously unknown bugs, confirmed by the library maintainers.â€ ([Xu ç­‰, 2024, p. 1522](zotero://select/library/items/WZEKF2GP)) ([pdf](zotero://open-pdf/library/items/3978GNSK?page=2))

### ğŸ“œ Conclusion

RPGé€šè¿‡åŸºäºæ± çš„ç”Ÿæˆå’Œæ³›å‹æ”¯æŒæ˜¾è‘—æé«˜äº†ç”Ÿæˆçš„æ¨¡ç³Šç›®æ ‡çš„è´¨é‡å’Œå‘ç°æ¼æ´çš„èƒ½åŠ›ï¼Œæ˜æ˜¾ä¼˜äºç°æœ‰æŠ€æœ¯ã€‚

## ğŸ¤” Personal Summary

* * *

> Tips: What aspects did you question, how do you think it can be improved?
> 
> **æ± **
> 
> RPGä¸­çš„â€œæ± â€æŒ‡çš„æ˜¯ä¸€ä¸ªAPIæ± ï¼Œå…¶ä¸­å­˜å‚¨äº†å¯ä»¥åœ¨Ruståº“ä¸­è°ƒç”¨çš„APIé›†åˆã€‚
> 
> **é™æ€åˆ†æ**
> 
> æ˜¯åœ¨ä¸è¿è¡Œä»£ç çš„æƒ…å†µä¸‹å¯¹ä»£ç è¿›è¡Œåˆ†æçš„æŠ€æœ¯ã€‚åœ¨RPGä¸­ï¼Œé™æ€åˆ†æè¢«ç”¨æ¥ä»Ruståº“ä¸­æå–å…³é”®ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š
> 
> - **å‡½æ•°å’Œæ•°æ®ç±»å‹ä¿¡æ¯**ï¼šRPGæå–åº“ä¸­å®šä¹‰çš„æ‰€æœ‰å…¬å…±APIï¼ˆå¦‚å‡½æ•°ã€æ–¹æ³•ï¼‰åŠå…¶ç›¸å…³çš„è¾“å…¥è¾“å‡ºæ•°æ®ç±»å‹ã€‚
> - **ä¸å®‰å…¨ä»£ç å—ï¼ˆUnsafe Code Blocksï¼‰**ï¼šRustå…è®¸åœ¨â€œunsafeâ€å—ä¸­æ‰§è¡Œä¸€äº›ä¸å—Rustç¼–è¯‘å™¨å®‰å…¨ä¿éšœçš„æ“ä½œï¼Œå¦‚ç›´æ¥æ“ä½œå†…å­˜ã€‚RPGä¼šç‰¹åˆ«å…³æ³¨è¿™äº›ä¸å®‰å…¨ä»£ç ï¼Œå› ä¸ºå®ƒä»¬æ›´å¯èƒ½åŒ…å«æ½œåœ¨çš„æ¼æ´ã€‚
> 
> ### æ„å»ºAPIä¾èµ–å›¾
> 
> åœ¨å®Œæˆé™æ€åˆ†æåï¼ŒRPGä¼šåˆ©ç”¨åˆ†æå¾—åˆ°çš„ä¿¡æ¯æ¥æ„å»ºä¸€ä¸ª**APIä¾èµ–å›¾**ã€‚è¿™ä¸ªä¾èµ–å›¾æè¿°äº†åº“ä¸­å„ä¸ªAPIä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œå…·ä½“æ¥è¯´ï¼š
> 
> - **ä¾èµ–å…³ç³»çš„å®šä¹‰**ï¼šå¦‚æœä¸€ä¸ªAPIçš„è¾“å‡ºå¯ä»¥ä½œä¸ºå¦ä¸€ä¸ªAPIçš„è¾“å…¥ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªAPIä¹‹é—´å°±å­˜åœ¨ä¾èµ–å…³ç³»ã€‚ä¾‹å¦‚ï¼Œå‡½æ•°Açš„è¾“å‡ºç±»å‹æ˜¯å‡½æ•°Bçš„ä¸€ä¸ªå‚æ•°ç±»å‹ï¼Œé‚£ä¹ˆå°±å­˜åœ¨Aä¾èµ–äºBçš„å…³ç³»ã€‚
> - **ç±»å‹ä¾èµ–**ï¼šå¯¹äºæ³›å‹å‡½æ•°ï¼ŒRPGä¼šè€ƒè™‘ä¸åŒçš„ç±»å‹çº¦æŸï¼Œå¹¶åœ¨ä¾èµ–å›¾ä¸­åæ˜ è¿™äº›ç±»å‹é—´çš„å…¼å®¹æ€§å’Œä¾èµ–æ€§ã€‚
> 
> æ„å»ºAPIä¾èµ–å›¾çš„ç›®çš„æ˜¯æ˜ç¡®å‡½æ•°è°ƒç”¨çš„é¡ºåºå’Œå…³ç³»

### //6. æ–‡çŒ®å¤„ç†åˆ†æï¼š`RPG: Rust Library Fuzzing with Pool-based Fuzz Target Generation and Generic Support`

#### 6.1. åºå· + æ–‡ç« åç§°

åºå·: 9  
æ–‡ç« åç§°: *RPG: Rust Library Fuzzing with Pool-based Fuzz Target Generation and Generic Support*

#### 6.2. æŸ¥çœ‹æ˜¯å¦åœ¨GitHubæˆ–å…¶ä»–ç½‘ç«™å­˜åœ¨ç›¸åº”ä»£ç 

ä»£ç å­˜åœ¨æ€§: æ–‡ä¸­æœªæåˆ°å…·ä½“çš„GitHubæˆ–å…¶ä»–ä»£ç æ‰˜ç®¡å¹³å°é“¾æ¥ã€‚

#### 6.3. åŒºåˆ†å¯¹LLMè¿›è¡ŒFuzzè¿˜æ˜¯ç”¨LLMè¾…åŠ©Fuzz

è¯¥æ–‡çŒ®æœªæ¶‰åŠLLMçš„fuzzingæˆ–LLMè¾…åŠ©fuzzingã€‚

#### 6.4. æ¯ä¸ªfuzzçš„ç”Ÿæˆæµ‹è¯•æ ·ä¾‹æ˜¯ä»€ä¹ˆï¼Œå¯¹è±¡æ˜¯ä»€ä¹ˆï¼Œå’Œç”Ÿæˆç­–ç•¥

- ç”Ÿæˆçš„æµ‹è¯•æ ·ä¾‹: Ruståº“çš„APIè°ƒç”¨åºåˆ—ï¼Œç‰¹åˆ«æ˜¯åŒ…å«ä¸å®‰å…¨ä»£ç å—çš„APIåºåˆ—ã€‚
- æµ‹è¯•å¯¹è±¡: //**Ruståº“**ï¼Œç‰¹åˆ«æ˜¯åŒ…å«æ³›å‹æ”¯æŒå’Œä¸å®‰å…¨ä»£ç çš„åº“ã€‚
- ç”Ÿæˆç­–ç•¥:
  
    - **æ± åŸºç”Ÿæˆ**: RPGä½¿ç”¨æ± åŸºç”Ÿæˆæ–¹æ³•åˆ›å»ºå¤šæ ·åŒ–çš„APIåºåˆ—ï¼Œä¼˜å…ˆè€ƒè™‘ä¸å®‰å…¨ä»£ç å—å’ŒAPIä¾èµ–å…³ç³»ã€‚
    - **é™æ€åˆ†æ**: é€šè¿‡é™æ€åˆ†ææ„å»ºAPIä¾èµ–å…³ç³»å›¾ï¼Œå¹¶ä½¿ç”¨å‚æ•°æä¾›å™¨å¤„ç†æ³›å‹å‡½æ•°ã€‚
    - **åºåˆ—ä¼˜åŒ–**: åŒ…æ‹¬å€Ÿç”¨æ£€æŸ¥ã€ç§»åŠ¨æ£€æŸ¥å’Œæ³›å‹å£°æ˜æ£€æŸ¥ï¼Œä»¥ç¡®ä¿ç”Ÿæˆçš„APIåºåˆ—çš„è¯­æ³•å’Œè¯­ä¹‰æœ‰æ•ˆæ€§ã€‚

#### 6.5. è‹¥æ˜¯Fuzz for LLMï¼Œè¯·æ³¨æ˜æµ‹è¯•çš„æ˜¯LLMå“ªä¸€éƒ¨åˆ†

è¯¥æ–‡çŒ®æœªæ¶‰åŠå¯¹LLMçš„fuzzingã€‚

#### 6.6. è‹¥æ˜¯LLM for Fuzzï¼Œè¯·æ³¨æ˜LLMåœ¨Fuzzä¸­å‘æŒ¥äº†ä»€ä¹ˆä½œç”¨

è¯¥æ–‡çŒ®æœªæ¶‰åŠLLMè¾…åŠ©fuzzingã€‚

### æ€»ç»“

æœ¬æ–‡æå‡ºäº†ä¸€ç§æ–°çš„Ruståº“æ¨¡ç³Šæµ‹è¯•æ–¹æ³•ï¼Œä½¿ç”¨æ± åŸºç”Ÿæˆç­–ç•¥æ¥åˆ›å»ºå¤šæ ·åŒ–çš„APIåºåˆ—ï¼Œå¹¶ä¸”æ”¯æŒæ³›å‹å‡½æ•°å’Œä¸å®‰å…¨ä»£ç å—ã€‚RPGé€šè¿‡å¯¹50ä¸ªRuståº“çš„æµ‹è¯•ï¼Œå±•ç¤ºäº†å…¶åœ¨APIè¦†ç›–ç‡å’Œé”™è¯¯æ£€æµ‹èƒ½åŠ›ä¸Šçš„æ˜¾è‘—æå‡ã€‚æ–‡ä¸­æ²¡æœ‰æåˆ°ä»£ç æ˜¯å¦åœ¨GitHubæˆ–å…¶ä»–å¹³å°ä¸Šå‘å¸ƒï¼Œä¹Ÿæœªæ¶‰åŠLLMæŠ€æœ¯ã€‚